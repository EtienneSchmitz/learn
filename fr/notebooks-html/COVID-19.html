


  <div class="cell border-box-sizing text_cell rendered">
    <button class="js-nbinteract-widget">
      Show All Widgets
    </button></div>



<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell"
  
>
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">pyplot</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">deque</span>
<span class="kn">import</span> <span class="nn">matplotlib</span> <span class="k">as</span> <span class="nn">mpl</span>

<span class="n">mpl</span><span class="o">.</span><span class="n">rcParams</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;font.size&#39;</span><span class="p">:</span> <span class="mi">14</span><span class="p">,</span>
                     <span class="s1">&#39;figure.figsize&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">17</span><span class="p">,</span><span class="mi">10</span><span class="p">)</span>
                    <span class="p">})</span>
</pre></div></div></div></div></div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell"
  
>
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">BaseScenario</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>  
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cases</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lockdowns</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">remaining_lockdown</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">remaining_incubation</span> <span class="o">=</span> <span class="mi">0</span>
    
    <span class="k">def</span> <span class="nf">simulate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">step</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">duration</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cases</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">next</span><span class="p">(</span><span class="n">step</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cases</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span>
            
            <span class="c1"># Update lockdown list if necessary</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">remaining_lockdown</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lockdowns</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="s2">&quot;end&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lockdowns</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lockdowns</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s2">&quot;start&quot;</span><span class="p">:</span> <span class="n">step</span><span class="p">})</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">remaining_lockdown</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lockdowns</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="s2">&quot;end&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lockdowns</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lockdowns</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s2">&quot;end&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">step</span>
    
    <span class="k">def</span> <span class="nf">plot</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Draw celebration markers</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">celebration</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">celebrations</span><span class="p">):</span>
            <span class="n">pyplot</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">celebration</span><span class="p">,</span> <span class="n">celebration</span><span class="p">],</span>
                        <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cases</span><span class="p">)],</span>
                        <span class="n">color</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">,</span>
                        <span class="n">label</span><span class="o">=</span><span class="s2">&quot;celebrations&quot;</span> <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>

        <span class="c1"># Draw lockdown periods</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">lockdown</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lockdowns</span><span class="p">):</span>
            <span class="n">pyplot</span><span class="o">.</span><span class="n">fill_between</span><span class="p">([</span><span class="n">lockdown</span><span class="p">[</span><span class="s2">&quot;start&quot;</span><span class="p">],</span>
                                 <span class="n">lockdown</span><span class="p">[</span><span class="s2">&quot;end&quot;</span><span class="p">]</span> <span class="k">if</span> <span class="s2">&quot;end&quot;</span> <span class="ow">in</span> <span class="n">lockdown</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">duration</span><span class="p">],</span>
                                 <span class="mi">0</span><span class="p">,</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cases</span><span class="p">),</span>
                                <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;green&#39;</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;lockdown&quot;</span> <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>

        <span class="n">pyplot</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cases</span><span class="p">)),</span> <span class="bp">self</span><span class="o">.</span><span class="n">cases</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;COVID-19 cases&quot;</span><span class="p">)</span>
        <span class="n">pyplot</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
        <span class="n">pyplot</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Lockdowns of </span><span class="si">{}</span><span class="s2"> days above </span><span class="si">{}</span><span class="s2"> cases, with </span><span class="si">{}</span><span class="s2"> celebrations and </span><span class="si">{}</span><span class="s2"> days of incubation&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                     <span class="bp">self</span><span class="o">.</span><span class="n">lockdown_duration</span><span class="p">,</span>
                     <span class="bp">self</span><span class="o">.</span><span class="n">critical</span><span class="p">,</span>
                     <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">celebrations</span><span class="p">),</span>
                     <span class="bp">self</span><span class="o">.</span><span class="n">incubation_duration</span><span class="p">))</span>
        <span class="n">pyplot</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;days&#39;</span><span class="p">)</span>
        <span class="n">pyplot</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;COVID-19 positive cases&#39;</span><span class="p">)</span>
        <span class="n">pyplot</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">duration</span><span class="o">/</span><span class="mi">4</span><span class="p">,</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cases</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;NAIVE SIMULATION&#39;</span><span class="p">,</span>
                    <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span>
                    <span class="n">color</span><span class="o">=</span><span class="s2">&quot;peru&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">25</span><span class="p">)</span>
        <span class="n">pyplot</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div></div></div></div></div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell"
  
>
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">Scenario</span><span class="p">(</span><span class="n">BaseScenario</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                 <span class="n">lockdown_duration</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
                 <span class="n">incubation_duration</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
                 <span class="n">duration</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
                 <span class="n">critical</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
                 <span class="n">celebrations</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span>
                 <span class="n">r0</span><span class="p">:</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Scenario</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lockdown_duration</span> <span class="o">=</span> <span class="n">lockdown_duration</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">incubation_duration</span> <span class="o">=</span> <span class="n">incubation_duration</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">duration</span> <span class="o">=</span> <span class="n">duration</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">critical</span> <span class="o">=</span> <span class="n">critical</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">celebrations</span> <span class="o">=</span> <span class="n">celebrations</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">r0</span> <span class="o">=</span> <span class="n">r0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">r0_history</span> <span class="o">=</span> <span class="n">deque</span><span class="p">(</span><span class="n">incubation_duration</span><span class="o">*</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">maxlen</span><span class="o">=</span><span class="n">incubation_duration</span><span class="p">)</span>
                    
    <span class="k">def</span> <span class="nf">next</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">step</span><span class="p">:</span><span class="nb">int</span><span class="p">,</span> <span class="n">previous_infected</span><span class="p">:</span><span class="nb">int</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">remaining_lockdown</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">r0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">r0</span><span class="p">[</span><span class="s2">&quot;lockdown&quot;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">remaining_lockdown</span> <span class="o">-=</span> <span class="mi">1</span>
        <span class="k">elif</span> <span class="n">previous_infected</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">critical</span><span class="p">:</span>
            <span class="n">r0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">r0</span><span class="p">[</span><span class="s2">&quot;lockdown&quot;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">remaining_lockdown</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lockdown_duration</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">r0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">r0</span><span class="p">[</span><span class="s2">&quot;regular&quot;</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">step</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">celebrations</span><span class="p">:</span>
            <span class="n">r0</span> <span class="o">*=</span> <span class="bp">self</span><span class="o">.</span><span class="n">r0</span><span class="p">[</span><span class="s2">&quot;high&quot;</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">r0_history</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">r0</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">r0_history</span><span class="o">.</span><span class="n">popleft</span><span class="p">()</span><span class="o">*</span><span class="n">previous_infected</span>
</pre></div></div></div></div></div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell"
  
>
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">s</span> <span class="o">=</span> <span class="n">Scenario</span><span class="p">(</span>
    <span class="n">lockdown_duration</span> <span class="o">=</span> <span class="mi">45</span><span class="p">,</span>
    <span class="n">incubation_duration</span><span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
    <span class="n">duration</span> <span class="o">=</span> <span class="mi">300</span><span class="p">,</span>
    <span class="n">critical</span> <span class="o">=</span> <span class="mi">5000</span><span class="p">,</span>
    <span class="n">celebrations</span> <span class="o">=</span> <span class="p">[</span>
                    <span class="mi">84</span><span class="p">,</span> <span class="mi">85</span><span class="p">,</span> <span class="mi">86</span><span class="p">,</span>     <span class="c1"># Celebration + lockdown</span>
                    <span class="mi">205</span><span class="p">,</span> <span class="mi">206</span><span class="p">,</span> <span class="mi">207</span>  <span class="c1"># Celebration but no lockdown</span>
                   <span class="p">],</span> 
    <span class="n">r0</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;regular&quot;</span><span class="p">:</span> <span class="mf">1.2</span><span class="p">,</span>
        <span class="s2">&quot;high&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
        <span class="s2">&quot;lockdown&quot;</span><span class="p">:</span> <span class="mf">0.9</span><span class="p">,</span>
    <span class="p">}</span>
<span class="p">)</span>
<span class="n">s</span><span class="o">.</span><span class="n">simulate</span><span class="p">()</span>
<span class="n">s</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div></div></div></div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">





<div class="output_png output_subarea ">
<img src="/notebooks-images/COVID-19_3_0.png"
></div></div></div></div></div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell"
  
>
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">s</span> <span class="o">=</span> <span class="n">Scenario</span><span class="p">(</span>
    <span class="n">lockdown_duration</span> <span class="o">=</span> <span class="mi">60</span><span class="p">,</span>
    <span class="n">incubation_duration</span> <span class="o">=</span> <span class="mi">15</span><span class="p">,</span>
    <span class="n">duration</span> <span class="o">=</span> <span class="mi">300</span><span class="p">,</span>
    <span class="n">critical</span> <span class="o">=</span> <span class="mi">5000</span><span class="p">,</span>
    <span class="n">celebrations</span> <span class="o">=</span> <span class="p">[</span>
                    <span class="mi">74</span><span class="p">,</span> <span class="mi">75</span><span class="p">,</span> <span class="mi">76</span><span class="p">,</span>     <span class="c1"># Celebration + lockdown</span>
                    <span class="mi">210</span><span class="p">,</span> <span class="mi">211</span><span class="p">,</span> <span class="mi">212</span>   <span class="c1"># Celebration but no lockdown</span>
                   <span class="p">],</span> 
    <span class="n">r0</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;regular&quot;</span><span class="p">:</span> <span class="mf">1.2</span><span class="p">,</span>
        <span class="s2">&quot;high&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
        <span class="s2">&quot;lockdown&quot;</span><span class="p">:</span> <span class="mf">0.9</span><span class="p">,</span>
    <span class="p">}</span>
<span class="p">)</span>
<span class="n">s</span><span class="o">.</span><span class="n">simulate</span><span class="p">()</span>
<span class="n">s</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div></div></div></div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">





<div class="output_png output_subarea ">
<img src="/notebooks-images/COVID-19_4_0.png"
></div></div></div></div></div>

